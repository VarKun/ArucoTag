# ArUcoTag Toolkit

ArucoTag is a collection of OpenCV utilities for working with ArUco and AprilTag style fiducial markers.  The scripts in this repository let you generate custom marker dictionaries, calibrate a camera from captured images, and then perform real-time detection of gates made from paired markers.  The tools are designed around Python 3.8+ and OpenCV's `cv2.aruco` module.

## Features

- **Marker generation** – Quickly export individual marker images from any predefined OpenCV dictionary (`generate_marker.py`).
- **Custom dictionary support** – Build and persist your own marker dictionary (`marker_dictionary_made.py`) for application specific IDs (`custom_dict.yml`).
- **Camera calibration** – Calibrate a camera from a folder of captured marker images and save intrinsic/extrinsic parameters to `ArucoCheckMultiMatrix.npz` (`calibration_camera.py`).
- **Real-time detection** – Detect markers from a webcam stream, highlight a "gate" built from IDs 0 and 1, and map its position to alphabetic direction cues (`ArUco_detect.py`).
- **Baseline detector** – Simple live preview that draws the bounding box and ID for every detected marker (`image.py`).

## Repository layout

```text
.
├── ArUco_detect.py           # Gate-detection pipeline with visual overlays
├── calibration_camera.py     # Batch camera calibration from captured marker photos
├── custom_dict.yml           # Serialized custom dictionary generated by marker_dictionary_made.py
├── generate_marker.py        # Utility for exporting predefined dictionary markers as PNGs
├── image.py                  # Minimal example showing how to detect ArUco tags from a webcam
├── marker_dictionary_made.py # Script to extend and persist a custom marker dictionary
├── ArucoCheckMultiMatrix.npz # Sample camera calibration (camera matrix + distortion coefficients)
└── image_detected/           # Folder of calibration images used by calibration_camera.py
```

## Getting started

1. **Create a virtual environment (optional but recommended)**

   ```bash
   python -m venv .venv
   source .venv/bin/activate  # On Windows use `.venv\Scripts\activate`
   ```

2. **Install dependencies**

   ```bash
   pip install opencv-python numpy
   ```

   > **Note:** If you plan to use `cv2.aruco` with AprilTag dictionaries, install `opencv-contrib-python` instead of the base wheel.

3. **Verify your webcam**

   All detection scripts default to `VideoCapture(0)`.  If you have multiple cameras, adjust the index or supply your own `cv2.VideoCapture` source.

## Workflow

### 1. Generate or extend a dictionary

- Use `marker_dictionary_made.py` to extend the built-in dictionary and save it to `custom_dict.yml`.  The script expects a sample image (`image_detected/right.jpg`) that already contains markers from the desired dictionary.
- Alternatively, rely on the stock dictionaries provided by OpenCV if custom IDs are not required.

### 2. Produce printable markers

Run `generate_marker.py` to export PNG files for IDs in the dictionary:

```bash
python generate_marker.py
```

Each generated `tag_<id>.png` is 400×400 pixels by default.  Adjust the dictionary or size inside the script to suit your needs.

### 3. Capture calibration images

1. Print at least one marker and place it on a flat surface.
2. Capture multiple photos from different angles and save them to `image_detected/` (or update `imagePath` inside `calibration_camera.py`).
3. Ensure `marker_Length` matches the physical size (in the same units you want returned for translations).

### 4. Calibrate the camera

Run:

```bash
python calibration_camera.py
```

The script will detect markers in each photo, assemble 3D–2D correspondences, and save intrinsic parameters to `ArucoCheckMultiMatrix.npz` (camera matrix, distortion coefficients, and pose vectors).  `ArUco_detect.py` loads this file to undistort and estimate gate geometry.

### 5. Detect markers in real time

Choose the detector that fits your needs:

- `ArUco_detect.py` – Highlights markers, detects the gate formed by IDs 0 and 1, reports gate area, and converts the horizontal midpoint to an alphabet character (lowercase by default, uppercase when the perceived gate size halves).
- `image.py` – Lightweight viewer that labels every detected marker without the gate-specific logic.

Launch any script with:

```bash
python ArUco_detect.py
```

Press `Esc` (or `q` in `image.py`) to close the preview window.

### 6. Integrate with your application

The detection scripts expose useful utility functions:

- `get_direction_character(x_coord, case)` maps the gate midpoint to alphabetic cues for navigation.
- `find_gate(corners, ids)` searches for the pair of markers (IDs 0 and 1) that form a gate at roughly the same vertical level and area.

You can import these functions into your own code or adapt the loop structure for different marker configurations.

## Tips & troubleshooting

- **Custom dictionary loading** – Ensure `custom_dict.yml` is present when running scripts that depend on it (`ArUco_detect*.py`, `calibration_camera.py`).  Regenerate the file with `marker_dictionary_made.py` if you change the dictionary.
- **Calibration path** – `ArUco_detect*.py` expect `ArucoCheckMultiMatrix.npz` to be one directory above the script when running from the repo root.  Adjust `calibration_path` if you move the file.
- **Performance** – Detection defaults to 1280×720 @ 60 FPS.  Lower the resolution or frame rate on resource constrained hardware.
- **Lighting** – High contrast lighting significantly improves detection accuracy.  Avoid glare on printed markers.

## License

No explicit license is provided.  Review the repository history or contact the original author before using it in production.

## Acknowledgements

The detection flow builds on the [PyImageSearch tutorial](https://www.pyimagesearch.com/2020/12/21/detecting-aruco-markers-with-opencv-and-python/) and OpenCV's `aruco` module.
